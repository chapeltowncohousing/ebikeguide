<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ebike guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ebike guide</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Chaco has 3 ebikes for communal use. These are shown in the photo below which includes:</p>
<ul>
<li>The ‘ecargo’, for shopping, towing trailers, and longer trips (middle)</li>
<li>The ‘efoldy’, for short trips (max distance around 10 km) and folding for storage/public transport (right)</li>
<li>The ‘Dutch’ ebike (name TBC) for general use (left)</li>
</ul>
<p><a href="https://youtu.be/VrXsrW0D9sc"><img src="images/paste-2_small.png" class="img-fluid"></a></p>
<p>The image above was taken form a video (see link below).</p>
</section>
<section id="ecargo" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Ecargo</h1>
<p>We have a Tern HSD (specifically the Tern HSD P5i Gen.2 Electric Cargo Bike, purchased from <a href="https://www.edinburghbicycle.com/tern-hsd-p5i-gen-2-electric-cargo-bike">Edinburgh Bike Cooperative</a>) for communal use.</p>
<p>The bike is a ‘compact’ electric cargo, weighing 27.9 kg (61.5 lb), meaning you may want to avoid steps when using it. It has a maximum recommended rider weight of 120 kg (264.6 lb) and a large rear rack capacity of 80 kg. It has a 545 Wh battery and a Bosch Performance Line motor, with a range of 51-121 km (32-76 mi). See specifications on the <a href="https://www.ternbicycles.com/uk/bikes/472/hsd-p5i">Tern website</a> for more information.</p>
<section id="using-it" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="using-it"><span class="header-section-number">2.1</span> Using it</h2>
<p>It lives in the ‘Gladiator’ shed next to the recycling bins. To unlock it you need the 2 sets of keys on green fobs. These are kept in the key box.</p>
<p>To unlock the bike you need to:</p>
<ul>
<li>Unlock the shed</li>
<li>Unlock the D lock and any other locks on the bike</li>
<li>Unlock the bike-mounted lock on the rear wheel</li>
</ul>
<p>Note: the bike-mounted lock snaps back when you unlock it. You need to push a ‘lever’ on the other side of the bike to lock it again. See video below for a demonstration of how to unlock the bike in the unlisted video at <a href="https://youtu.be/VrXsrW0D9sc">youtu.be/VrXsrW0D9sc</a>.</p>
<!-- https://youtu.be/VrXsrW0D9sc -->
<p>Always lock the bike to a secure object with the grinder-proof ‘Litelok’ lock that lives inside the panniers, as shown in the photo below (taken from the bike’s first utility trip in Chaco).</p>
<p><img src="images/paste-1_small.png" class="img-fluid"></p>
</section>
<section id="charging" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="charging"><span class="header-section-number">2.2</span> Charging</h2>
<p>If the bike has less than 50% charge after your ride, plug it in to charge after you’ve finished using it.</p>
</section>
<section id="additional-information" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="additional-information"><span class="header-section-number">2.3</span> Additional information</h2>
<!-- https://www.ternbicycles.com/uk/bikes/472/hsd-p5i -->
<ul>
<li>See the product page on <a href="https://www.ternbicycles.com/uk/bikes/472/hsd-p5i">Tern’s website</a> <!-- https://www.ternbicycles.com/uk/bikes/support/1885/manuals --></li>
<li>See the manuals for the bike at <a href="https://www.ternbicycles.com/uk/bikes/support/1885/manuals">Tern’s website</a> <!-- https://www.bosch-ebike.com/fileadmin/EBC/Service/Downloads/Bedienungsanleitungen/MY2023/Intuvia100_BHU3200/BHU3200_Intuvia100_MY23_WEU_oReg.pdf?_=1708417638 --></li>
<li>See the manual for the display at <a href="https://www.bosch-ebike.com/fileadmin/EBC/Service/Downloads/Bedienungsanleitungen/MY2023/Intuvia100_BHU3200/BHU3200_Intuvia100_MY23_WEU_oReg.pdf?_=1708417638">bosch-ebike.come</a></li>
</ul>

</section>
</section>


<div id="quarto-appendix" class="default"><section id="bid-submission" class="level1 appendix" data-number="3"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">3</span> Bid submission</h2><div class="quarto-appendix-contents">

<p>We could afford the ecargo thanks to funding from the Leeds Community Climate Grant. Key bits from the bid submission are below:</p>
<!-- ## Summary -->
<p>Chapeltown Cohousing has substantial experience building sustainable community-led projects. Running for more than 20 years, with strong roots in Chapeltown, we have a track record of delivering. We successfully navigated the challenges of building 29 sustainable and affordable homes, and have built one of the most diverse and inclusive housing communities in the UK.</p>
<p>We have experience with solar PV and appropriate transport technology. We already have 49 kWp of solar PV installed on our south facing roofspace, providing around 1/3rd of our electricity needs, but would like to increase this. We have experience getting people to travel in more sustainable ways, with a successful car share meaning that we only need 14 parking spaces for 29 homes. We have a well-used e-bike and informally share bikes between ourselves and share our bike riding and maintenance skills with each other and the wider community, with two of our members involved in the Bike Fix Sunday project in Chapeltown, Back Newton Grove, just next to Potternewton Park.</p>
<p>We also have specific experience making use of e-cargo bikes, having borrowed one from Leeds City Council in early 2023, which was used frequently for shopping trips, moving furniture, and other short trips. We have learned that this is a popular and useful resource for our community, and we would like to make this a permanent feature of our community.</p>
<!-- ## Overview -->
<!-- Current word count: 553 -->
<p>The aims are to:</p>
<ul>
<li>Replace short car trips with sustainable e-cargo trips in Leeds</li>
<li>Enable people from diverse backgrounds to gain confidence with cycling for everyday trips that require carrying loads</li>
<li>Demonstrate how renewable sources of power can combine with emerging sustainable technologies to provide zero-carbon mobility in our Chapeltown Cohousing and the wider community</li>
</ul>
<p>We are seeking funding for:</p>
<ul>
<li>An e-cargo bike to facilitate sustainable transportation within our community.</li>
<li>A secure storage shed for the e-cargo bike</li>
<li>Solar PV panels on the south facing roof of our shared workshop</li>
<li>Battery storage system to store electricity to charge the e-cargo bike, other ebikes, tools, batteries and also for garden equipment such as lawnmover and shredder.</li>
<li>A smart battery charger for communal use</li>
</ul>
<p>To assess the demand for an e-cargo bike within Chapeltown Cohousing, we conducted a survey of our community members. The results of the survey are shown in the table (see supporting documentation). The survey revealed that 14 out of 17 respondents would use an e-cargo bike at least once per month, with 7 respondents indicating that they would use it around once per month, 4 respondents indicating that they would use it 2-3 times per month, and 3 respondents indicating that they would not use it at all (see attached survey results).</p>
<p>This demonstrates a high demand for an e-cargo bike within our community.</p>
<p>We have researched options for e-cargo bikes and have found a suitable model from a local bike shop, Edinburgh Bike Cooperative. The Tern GSD S00 is ideal for our community’s needs. It’s cargo and passenger ready, with a rear rack capacity of 200kg, virtually maintenance free Shimano internal gears and Gates belt drive, and a powerful motor that will enable hilly trips to Lidl, Tesco (common trips for our members) or other destinations in Leeds.</p>
<p>The powerful motor will also help members who need to get into town via the new cycle infrastructure on Clay Pit Lane, which has a steep gradient. The bike’s quality will make it low-maintenance, which is important for our community members who may not have the time or skills to maintain a bike.</p>
<p>The following accessories are also required to get the most out of the e-cargo bike:</p>
<ul>
<li>Cargo box, including modular ‘Clubhouse+’ and ‘sidekick’ carrier extension: this will allow us to transport groceries, tools, and other items safely and securely.</li>
<li><a href="https://www.theelectricbikeshop.co.uk/shop/accessories/sub/cargo-bike-accessories/tern-cargo-lid-lock-for-strorm-box-cargo-lid-17459/option/">Cargo box lock</a>: to secure the cargo box and its contents.</li>
<li><a href="https://www.decathlon.co.uk/p/mp/burley/burley-flatbed-cargo-bike-trailer/_/R-p-1e337590-843f-4fd4-9235-864c83debcef">Cargo bike trailer</a>: this will allow us to transport larger items, such as furniture, and will be useful for moving items, the flatbed design offering maximum versatility.</li>
<li>High quality bike lock: to secure the e-cargo bike when not in use.</li>
</ul>
<p>We will install additional solar PV panels on the south facing workshop roofspace. This will increase our solar generation capacity, allowing us to generate more clean energy and further reduce our carbon emissions.</p>
<p>We will install a battery storage system to store the excess electricity generated. This will allow us to use the stored energy to charge the e-cargo bike even on cloudy days and overnight.</p>
<p>We are seeking funding for the total project cost of £15,004.97. The breakdown of the budget, including exact quotes from local companies, is provided below.</p>
<div class="cell">
<div id="tbl-quotes" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-quotes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Quotes for Project Costs
</figcaption>
<div aria-describedby="tbl-quotes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 52%">
<col style="width: 5%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Item</th>
<th style="text-align: left;">Cost</th>
<th style="text-align: left;">Supplier (source of quote)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">E-cargo bike</td>
<td style="text-align: left;">6,100</td>
<td style="text-align: left;">Local bike shop (Edinburgh Bike Cooperative)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tern Clubhouse+ carrier extension</td>
<td style="text-align: left;">230</td>
<td style="text-align: left;">Local bike shop (Edinburgh Bike Cooperative)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tern Sidekick carrier extension</td>
<td style="text-align: left;">140</td>
<td style="text-align: left;">Local bike shop (Edinburgh Bike Cooperative)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tern Storm Box cargo box</td>
<td style="text-align: left;">230</td>
<td style="text-align: left;">Local bike shop (Edinburgh Bike Cooperative)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tern Cargo Lid Lock</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">Local bike shop (Edinburgh Bike Cooperative)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Burley Flatbed Cargo Bike Trailer</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">Local shop (Decathlon)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bike lock (Next Generation Angle-Grinder Resistant Armoured D-Lock)</td>
<td style="text-align: left;">150</td>
<td style="text-align: left;">litelok.com</td>
</tr>
<tr class="even">
<td style="text-align: left;">Secure storage shed</td>
<td style="text-align: left;">2,731</td>
<td style="text-align: left;">Local supplier (Asgard)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Battery charger</td>
<td style="text-align: left;">94</td>
<td style="text-align: left;">Online supplier (buyabattery.co.uk)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Battery storage system</td>
<td style="text-align: left;">3,000</td>
<td style="text-align: left;">Local solar panel installer (Solar Solutions Ltd TBC)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PV installation</td>
<td style="text-align: left;">2,000</td>
<td style="text-align: left;">Local solar panel installer (Solar Solutions Ltd TBC)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">15,005</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>